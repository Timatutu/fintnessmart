# ТЗ: AI‑платформа для анализа фитнес‑прогресса и персональных тренировок (с MCP)

## 1) Цель проекта
Платформа для анализа фитнес‑прогресса: пользователи ведут историю тренировок, получают
аналитику, рекомендации и персональные планы.

Важно: в рамках текущей версии **ИИ используется только как чат-бот‑тренер**.
Анализ видео/аудио через ИИ в MVP не реализуется.

Архитектура микросервисная, фронт у Артема, бэк — 6 сервисов.

## 2) Ключевые функции
- Ведение тренировок и прогресса (вес, повторения, объем, регулярность).
- LLM‑чатбот генерирует планы тренировок, рекомендации и отвечает на вопросы пользователя.
- Аналитика прогресса (графики веса/повторов, тренды, прогноз плато).
- Граф связей упражнений и мышц (отжимания → грудь → трицепс).

## 3) Распределение ролей по микросервисам

| Микросервис | Ответственный | Стек и роль |
|---|---|---|
| Сервис 1: Бизнес‑логика | Глеб Буравчик | FastAPI + Postgres — профили, CRUD тренировок, челленджи |
| Сервис 2: Аналитика | Тимур Хозяин | FastAPI + ClickHouse — дашборды, тренды |
| Сервис 3: Графовые связи | Артур Лыжник | FastAPI + Neo4j — связи упражнений/мышц |
| Сервис 4: Упрощённая бизнес‑логика | Михаил Броски | FastAPI + Postgres — быстрые API для фронта |
| Сервис 5: LLM‑чатбот и рекомендации | Иванус | FastAPI + LLM — чатбот‑тренер, персональные планы, ответы по прогрессу |
| Сервис 6: MCP‑шлюз интеграций | Дмитрий | FastAPI + MCP сервер — единая точка доступа к сервисам 1/2/3/4 для LLM |
| Фронтенд | Артем Клыкин | React/Vue — личный кабинет, дашборды, чат |

## 4) Архитектура (верхний уровень)

Схема сервисов и зоны ответственности:
- `Frontend` (React/Vue): личный кабинет, дашборды, чат с AI‑тренером.
- `Сервис 1` (FastAPI + Postgres): профили, CRUD тренировок, челленджи.
- `Сервис 2` (FastAPI + ClickHouse): аналитика, тренды, витрины метрик.
- `Сервис 3` (FastAPI + Neo4j): граф связей упражнений и мышц.
- `Сервис 4` (FastAPI + Postgres): упрощенная бизнес‑логика и быстрые API для фронта.
- `Сервис 5` (FastAPI + LLM): чатбот‑тренер, персональные планы, рекомендации.
- `Сервис 6` (FastAPI + MCP): внутренний шлюз инструментов и доступов для LLM.

Варианты архитектурных треков:
- **Трек А:** FastAPI‑монолит + 2–3 FastAPI‑сервиса (рекомендуется для быстрого MVP и небольшой команды).
- **Трек Б:** 2–3 микросервиса на FastAPI (баланс между гибкостью и сложностью поддержки).
- **Трек В:** 3–4 крупных сервиса на FastAPI (SOA; подходит при росте нагрузки и команд).

План по базам данных:
- `Postgres` — транзакционные данные (профили, тренировки, планы, рекомендации, челленджи).
- `ClickHouse` — аналитика и агрегаты по прогрессу (временные ряды, тренды, отчеты).
- `Neo4j` — граф упражнений/мышц и связи между сущностями.
- `Redis` (опционально) — кэш быстрых ответов чата, rate limit, временные сессии.
- `S3/MinIO` (опционально) — хранение вложений/файлов пользователя, если потребуется.

## 5) MCP‑интеграция 6-го микросервиса

### 4.1 Назначение MCP в проекте
MCP сервер в 6‑м сервисе используется как единый шлюз для инструментов LLM (сервиса 5):
- доступ к внутренним API других микросервисов;
- доступ к аналитике и графу упражнений;
- передача контекста для генерации персональных планов и ответов чатбота.

### 4.2 Архитектура интеграции
- Микросервис 6 разворачивает MCP‑сервер (внутренний, без публичного интернета).
- LLM в сервисе 5 подключается к MCP‑серверу и вызывает инструменты.
- MCP‑сервер проксирует доступ к:
  - Сервису 1 (профили, история тренировок),
  - Сервису 2 (метрики прогресса),
  - Сервису 3 (граф связей упражнений),
  - Сервису 4 (быстрые API для фронта/оперативных запросов).

### 4.3 MCP‑инструменты (минимальный набор)
- `get_user_profile(user_id)`
- `get_training_history(user_id, range)`
- `get_progress_metrics(user_id, range)`
- `get_exercise_graph(exercise_id)`
- `get_user_notes(user_id, range)`
- `save_recommendation(user_id, plan, summary)`

### 4.4 Требования к MCP
- MCP работает по внутренней сети (service‑to‑service).
- Аутентификация: сервисные токены между микросервисами.
- Логи MCP: запрос, инструмент, время ответа, код результата.
- Ограничение доступа: MCP вызывается только сервисом 5 (LLM‑чатботом).

### 4.5 Поток данных
1) Пользователь заполняет профиль, добавляет тренировки и заметки.
2) Сервис 1 сохраняет данные, сервис 2 считает аналитику.
3) Сервис 5 (LLM‑чатбот) через MCP (сервис 6) подтягивает данные из сервисов 1/2/3/4.
4) LLM в сервисе 5 формирует персональный план/ответ в чате.
5) Сервис 5 сохраняет рекомендации (через MCP‑инструмент) и отдает результат фронту.

## 6) Техническая реализация
- Интеграции: Kafka для событий ("новая тренировка → аналитика"), gRPC для быстрых вызовов.
- Наблюдаемость: Prometheus + Grafana.
- Деплой: Docker/K8s.
- MVP 3–4 недели: трекинг тренировок + дашборд + LLM‑чатбот с рекомендациями.

## 7) Монетизация
- Freemium: базовый чатбот и базовые планы бесплатно.
- Premium: расширенные персональные рекомендации, углубленная аналитика и долгосрочные программы.

## 8) Примеры использования (пользовательские сценарии)

### Сценарий 1: Новый пользователь
Пользователь заходит в приложение → заполняет профиль (цель: похудение/набор массы, уровень, ограничения) → получает от чатбота стартовый план на 2 недели + пояснение по нагрузке.

### Сценарий 2: После тренировки
Пользователь заходит после тренировки → добавляет выполненные упражнения, вес и повторения → получает краткий разбор прогресса за неделю и корректировку следующей тренировки.

### Сценарий 3: Вопрос в чате
Пользователь заходит в чат и спрашивает: "Почему не растет рабочий вес в жиме?" → чатбот подтягивает историю тренировок и аналитику → выдает причину (например, перегруз/недовосстановление) и конкретные шаги на 7 дней.

### Сценарий 4: Риск плато
Пользователь открывает дашборд → видит предупреждение о возможном плато по целевому упражнению → получает от чатбота альтернативный микроцикл (вариации упражнений + изменение объема).

### Сценарий 5: Возврат после перерыва
Пользователь заходит после 2–3 недель перерыва → чатбот анализирует прошлую нагрузку → предлагает мягкий план возвращения на 10 дней с безопасным повышением интенсивности.


┌─────────────────────────────────────────────────────────────────┐
│                          ФРОНТЕНД                               │
│                     (React/Vue - Артем)                         │
│  ┌─────────────┬──────────────┬─────────────┬──────────────┐    │
│  │ Личный      │ Дашборды     │ Чат с       │ Управление   │    │
│  │ кабинет     │ аналитика    │ AI-тренером │ тренировками │    │
│  └─────────────┴──────────────┴─────────────┴──────────────┘    │
└────────────────────────────┬────────────────────────────────────┘
                             │ HTTPS/REST
┌────────────────────────────▼────────────────────────────────────┐
│                    API GATEWAY/LOAD BALANCER                    │
└────────────────────────────┬────────────────────────────────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
┌───────▼───────┐    ┌───────▼───────┐    ┌───────▼───────┐
│  СЕРВИС 1     │    │  СЕРВИС 2     │    │  СЕРВИС 3     │
│ Бизнес-логика │    │ Аналитика     │    │ Графовые      │
│ (Глеб)        │    │ (Тимур)       │    │ связи (Артур) │
│ FastAPI +     │    │ FastAPI +     │    │ FastAPI +     │
│ Postgres      │    │ ClickHouse    │    │ Neo4j         │
└───────┬───────┘    └───────┬───────┘    └───────┬───────┘
        │                    │                    │
┌───────▼───────┐    ┌───────▼───────┐    ┌───────▼───────┐
│  СЕРВИС 4     │    │  СЕРВИС 5     │    │  СЕРВИС 6     │
│ Упрощенная    │    │ LLM-чатбот    │    │ MCP-шлюз      │
│ бизнес-логика │    │ (Иванус)      │    │ (Дмитрий)     │
│ (Михаил)      │    │ FastAPI + LLM │    │ FastAPI + MCP │
│ FastAPI +     │    │               │    │               │
│ Postgres      │    └───────┬───────┘    └───────┬───────┘
└───────────────┘            │                    │
                             └────────────────────┘
                                      │
                              ┌───────▼───────┐
                              │     MCP       │
                              │   Интеграция  │
                              └───────────────┘
